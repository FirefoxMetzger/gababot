<!DOCTYPE html>
<html>
<head>

<script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
<script type="text/javascript" src="Key.js"></script>
<script type="text/javascript" src="Keyboard.js"></script>

<script type="text/javascript" type="text/javascript">
var rosBridge = new ROSLIB.Ros
({
    url : 'ws://localhost:9090'
});

function bridgeStatus (text)
{
	var fbDiv = document.getElementById('feedback');
	fbDiv.innerHTML += text;
}

rosBridge.on
(
	'connection', 
	() => {bridgeStatus("<p>Connected to websocket server.</p>");}
);

rosBridge.on
(
	'error', 
	(error)=>{bridgeStatus("<p>Error connecting to websocket server.</p>");}
);

rosBridge.on
(
	'close',
	()=>{bridgeStatus("<p>Connection to websocket server closed.</p>");}
);

var keyboard_topic = new ROSLIB.Topic({
ros : rosBridge,
name : '/keyboard',
messageType : '/jake/Keyboard'
});

//var keyboard_message = new ROSLIB.MESSAGE
</script>
</head>

<body>
<div id="test"></div>
<div id="feedback"></div>
<script type="text/javascript" type="text/javascript">
document.getElementById("test").innerHTML = JSON.stringify("Hello World");
var keyboard_state = new KeyboardState();
var key = {code:"KeyQ",key:"Q",location:0};
document.getElementById("test").innerHTML = JSON.stringify(keyboard_state);
onkeydown = function(e) 
{
	e = e || event;
	keyboard_state.addKey(e);
	document.getElementById("test").innerHTML = JSON.stringify(keyboard_state);

	var keyboard_message = new ROSLIB.Message(keyboard_state);
	keyboard_topic.publish(keyboard_message);
}

onkeyup = function(e)
{
	e = e || event;
	keyboard_state.removeKey(e);
	document.getElementById("test").innerHTML = JSON.stringify(keyboard_state);
}
</script>
</body>
</html>
